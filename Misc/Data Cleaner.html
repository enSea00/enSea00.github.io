<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Data Cleaner</title>
<style>
      html, body {
        box-sizing: border-box;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-3.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.0.3.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
    
        <script type="text/javascript" src="MyCustomFunctions.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.0/papaparse.min.js"></script>
        
        <style>
    
            /* ---------- Page tabs styling -----------*/
            .bk-root .bk-tab {
                background-color: #15191C;
                color: white;
                opacity: 0.8;
                border-style: solid;
                outline_line_color: white;
            }
            
            .bk-root .bk-tabs-header .bk-tab.bk-active{
                background-color: lightskyblue;
                color: black;
                font-weight: bold;
                }
            
            .bk-root .bk-tabs-header .bk-tab:hover{
                background-color: lightsteelblue;
                }
            
            /* ---------- Font and Heading Styling -----------*/
            h1 {color: lightskyblue;}
            
            h2 {color: lightskyblue;}
            
            h3 {color: lightsteelblue;}
            
            body {
                background-color: #15191C;
                color: white;
                opacity: 0.8;
                }
            
            /* hyperlink styling */
            a:link {color: white;
                    }
            
            a:visited {color: white;
                       }
            
            a:hover {color: white;
                     }
            
            a:active {color: white;
                      }
            /* ------------ Toolbar icon styling ----------*/
            .bk-toolbar-button.bk-tool-icon-hover {display: none;}
            .bk-toolbar-button.bk-tool-icon-wheel-zoom {display: none;}
            .bk-toolbar-button.bk-tool-icon-tap-select {display: none;}
            .bk-toolbar-button.bk-tool-icon-pan {display: none;}
            
    
        </style>
  </head>
  <body>
    <div id="abec51cc-d7db-4bab-bb67-8764e749878b" data-root-id="p77466" style="display: contents;"></div>
  
    <script type="application/json" id="p77686">
      {"d23653b9-81fe-46af-83b2-a15361baa5cf":{"version":"3.0.3","title":"Bokeh Application","defs":[],"roots":[{"type":"object","name":"Row","id":"p77466","attributes":{"children":[{"type":"object","name":"Column","id":"p77463","attributes":{"width":410,"children":[{"type":"object","name":"Div","id":"p77462","attributes":{"text":"&lt;h1&gt;Data Cleaner App&lt;/h1&gt;\n\n              &lt;p&gt;This app can be used to undertake a quality control analysis and cleaning of time series data.&lt;/p&gt;\n              \n              &lt;ol&gt;\n                  &lt;li&gt;Upload the raw data file.&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;&lt;b&gt;&lt;u&gt;IMPORTANT NOTE&lt;/u&gt;: &lt;/b&gt;The input csv file must have two columns [DateTime, Data] with DateTime having the format: dd/mm/yyyy HH:MM:SS.&lt;/li&gt;\n                  &lt;/ul&gt;\n                  &lt;br&gt;\n                  &lt;li&gt;Manual quality control and data cleaning&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;User can manually clean the data by selecting data points with the Box Select Tool and then clicking the Delete Selected Points button.&lt;/li&gt;\n                   &lt;/ul&gt;\n                   &lt;br&gt;\n                  &lt;li&gt;Export the cleaned data&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;click the Export Cleaned Data button.&lt;/li&gt;\n                  &lt;/ul&gt;\n              &lt;/ol&gt;\n              &lt;p&gt;Note that the app can be quite slow when handling large data sets&lt;/p&gt;\n              \n              &lt;h2&gt;Open raw data file (.csv):&lt;/h2&gt;\n              &lt;p&gt;&lt;i&gt;&lt;b&gt;*** &lt;u&gt;IMPORTANT NOTE&lt;/u&gt;:&lt;/b&gt; &lt;/i&gt;File must consist of two columns: &lt;br&gt; [DateTime, Data] with the DateTime column formatted as 'dd/mm/yyyy HH:MM:SS'&lt;/p&gt;\n              \n              "}},{"type":"object","name":"FileInput","id":"p77450","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p77451","attributes":{"args":{"type":"map","entries":[["source_raw",{"type":"object","name":"ColumnDataSource","id":"p77321","attributes":{"selected":{"type":"object","name":"Selection","id":"p77322","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p77323"},"data":{"type":"map","entries":[["DateTime_Raw",[]],["Data_Raw",[]]]}}}],["source_clean",{"type":"object","name":"ColumnDataSource","id":"p77324","attributes":{"selected":{"type":"object","name":"Selection","id":"p77325","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p77326"},"data":{"type":"map","entries":[["DateTime_Clean",[]],["Data_Clean",[]]]}}}],["status_text_cleaner",{"type":"object","name":"TextInput","id":"p77449","attributes":{"width":400,"title":"Status:","value":"Waiting for file input."}}],["status_label_cleaner",{"type":"object","name":"Label","id":"p77448","attributes":{"text":"Waiting for file input.","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"30px","text_align":"center","x":433,"x_units":"screen","y":350,"y_units":"screen"}}],["csvfile_input",{"id":"p77450"}],["plot_cleaner",{"type":"object","name":"Figure","id":"p77327","attributes":{"width":1300,"height":700,"x_range":{"type":"object","name":"DataRange1d","id":"p77329"},"y_range":{"type":"object","name":"DataRange1d","id":"p77328"},"x_scale":{"type":"object","name":"LinearScale","id":"p77341"},"y_scale":{"type":"object","name":"LinearScale","id":"p77343"},"title":{"type":"object","name":"Title","id":"p77330","attributes":{"text":" ","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p77396","attributes":{"data_source":{"id":"p77321"},"view":{"type":"object","name":"CDSView","id":"p77397","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p77398"}}},"glyph":{"type":"object","name":"Line","id":"p77393","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Data_Raw"},"line_color":"#1f77b4"}},"nonselection_glyph":{"type":"object","name":"Line","id":"p77394","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Data_Raw"},"line_color":"#1f77b4","line_alpha":0.1}},"muted_glyph":{"type":"object","name":"Line","id":"p77395","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Data_Raw"},"line_color":"#1f77b4","line_alpha":0.2}}}},{"type":"object","name":"GlyphRenderer","id":"p77420","attributes":{"data_source":{"id":"p77324"},"view":{"type":"object","name":"CDSView","id":"p77421","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p77422"}}},"glyph":{"type":"object","name":"Circle","id":"p77417","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Data_Clean"},"line_color":{"type":"value","value":"#ff7f0e"},"fill_color":{"type":"value","value":"#ff7f0e"},"fill_alpha":{"type":"value","value":0.8},"hatch_color":{"type":"value","value":"#ff7f0e"}}},"selection_glyph":{"type":"object","name":"Circle","id":"p77441","attributes":{"line_color":{"type":"value","value":"#ff7f0e"},"line_alpha":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"#ff7f0e"},"fill_alpha":{"type":"value","value":0.2}}},"nonselection_glyph":{"type":"object","name":"Circle","id":"p77442","attributes":{"line_color":{"type":"value","value":"#ff7f0e"},"fill_color":{"type":"value","value":"#ff7f0e"}}},"muted_glyph":{"type":"object","name":"Circle","id":"p77419","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Data_Clean"},"line_color":{"type":"value","value":"#ff7f0e"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"#ff7f0e"},"fill_alpha":{"type":"value","value":0.2},"hatch_color":{"type":"value","value":"#ff7f0e"},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p77335","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p77359"},{"type":"object","name":"BoxZoomTool","id":"p77360","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p77361","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p77362"},{"type":"object","name":"ResetTool","id":"p77363"},{"type":"object","name":"HoverTool","id":"p77412","attributes":{"renderers":[{"id":"p77396"}],"tooltips":[["Date Time","@DateTime_Raw{%H:%M %d/%m/%Y}"],["Data_Raw","@Data_Raw"]],"formatters":{"type":"map","entries":[["@DateTime_Raw","datetime"]]}}},{"type":"object","name":"HoverTool","id":"p77443","attributes":{"renderers":[{"id":"p77420"}],"tooltips":[["Date Time","@DateTime_Clean{%H:%M %d/%m/%Y}"],["Data_Clean","@Data_Clean"]],"formatters":{"type":"map","entries":[["@DateTime_Clean","datetime"]]}}},{"type":"object","name":"BoxSelectTool","id":"p77445","attributes":{"renderers":[{"id":"p77420"}],"overlay":{"type":"object","name":"BoxAnnotation","id":"p77446","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}}],"active_drag":{"id":"p77360"},"active_scroll":{"id":"p77362"}}},"toolbar_location":"above","left":[{"type":"object","name":"LinearAxis","id":"p77352","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p77355","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p77353"},"axis_label":"Raw Gauge Data","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p77354"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p77389","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"click_policy":"hide","label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p77411","attributes":{"label":{"type":"value","value":"Raw Data"},"renderers":[{"id":"p77396"}]}},{"type":"object","name":"LegendItem","id":"p77440","attributes":{"label":{"type":"value","value":"Cleaned Data"},"renderers":[{"id":"p77420"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p77345","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p77348","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p77370","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p77347"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p77351","attributes":{"axis":{"id":"p77345"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p77358","attributes":{"dimension":1,"axis":{"id":"p77352"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"id":"p77448"}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}]]},"code":"\n    \n        function StatusTextLoading(){\n            status_text_cleaner.value = 'Loading data ...'\n            status_label_cleaner.text = 'Loading data ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner.value = 'File import complete.'    \n            status_label_cleaner.text = ' '\n            }\n    \n        // file loading ////////////////////////////////////////////////////\n        function process_file() {\n    \n            var file_contents = cb_obj.value;\n            \n            // read in entire file and decode text\n            const decoded_file_contents = atob(file_contents);\n            const file_lines = decoded_file_contents.split(\"\\n\");\n            \n            // initialise arrays        \n            var DateTime_Raw = [];\n            var Data_Raw = [];\n            \n            // read the file data line by line   //////////////////////////////////\n            for (var i = 1; i &lt; file_lines.length; i++) {\n                \n                // read a line\n                var line = file_lines[i]\n\n                // check for end of file\n                if (line.trim().length === 0 || line.trim() === \"\") {continue}\n                \n                // get the time series data\n                var tmp = line.split(',')\n                var data = parseFloat(tmp[1].trim())\n                Data_Raw.push(data);\n\n                // parse date time\n                var datetime_string = tmp[0];\n                var date_parts = datetime_string.split(\" \")[0].split(\"/\");\n                var time_parts = datetime_string.split(\" \")[1].split(\":\");\n                var datetime = new Date(date_parts[2], date_parts[1] - 1, date_parts[0], time_parts[0], time_parts[1]);\n                datetime = Math.floor(datetime.getTime()) // unix timestamp\n                DateTime_Raw.push(datetime)\n                \n                } // end of line by line loop\n    \n            // create data source\n            source_raw.data = {DateTime_Raw: DateTime_Raw, Data_Raw: Data_Raw}; \n            source_raw.change.emit();\n            \n            // remove non-unique values - keeps last occurrence ///////////////////\n            let DateTime_Clean = DateTime_Raw; \n            let Data_Clean = Data_Raw; \n\n            let numbers = DateTime_Clean; \n            let [uniqueWithLastOccurrence, indices] = getUniqueWithLastOccurrence(numbers);\n            DateTime_Clean = subsetArray(DateTime_Clean,indices)\n            Data_Clean = subsetArray(Data_Clean,indices)\n            \n            // update sources /////////////////////////////////////////////////////\n            source_clean.data = {DateTime_Clean: DateTime_Clean, Data_Clean: Data_Clean};\n            source_clean.change.emit();\n    \n        }  // end of process_file function\n    \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            plot_cleaner.title.text = csvfile_input.filename;\n            setTimeout(process_file, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n        \n        CallbackTiming()\n        \n    "}}]]]},"width":400,"value":"","mime_type":"","filename":"","accept":".csv"}},{"id":"p77449"}]}},{"type":"object","name":"Column","id":"p77465","attributes":{"children":[{"id":"p77327"},{"type":"object","name":"Row","id":"p77464","attributes":{"children":[{"type":"object","name":"Button","id":"p77452","attributes":{"button_type":"danger","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p77453","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p77324"}],["status_label_cleaner",{"id":"p77448"}],["status_text_cleaner",{"id":"p77449"}]]},"code":"\n                               \n        function StatusTextLoading(){\n            status_text_cleaner.value = 'Deleting selected data ...'\n            status_label_cleaner.text = 'Deleting selected data ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner.value = 'Data deletion complete.'    \n            status_label_cleaner.text = ' '\n            }\n\n        function processing(){\n                                           \n            var indices = source_clean.selected.indices;\n            if (indices.length == 0) {\n                return;\n            }\n            \n            // declare variables        \n            var data = source_clean.data;\n            var x = data['DateTime_Clean'];\n            var y = data['Data_Clean'];\n            var removed_x = [];\n            var removed_y = [];\n            \n            // remove data and store for later recovery\n            for (var i = 0; i &lt; indices.length; i++) {\n                removed_x.push(x[indices[i]]);\n                removed_y.push(y[indices[i]]);\n            }\n            window.removed_data = {'x': removed_x, 'y': removed_y};\n            \n            var new_x = [];\n            var new_y = [];\n            for (var i = 0; i &lt; x.length; i++) {\n                if (indices.indexOf(i) == -1) {\n                    new_x.push(x[i]);\n                    new_y.push(y[i]);\n                }\n            }\n            \n            // update sources /////////////////////////////////////////////////////\n            source_clean.data = {DateTime_Clean: new_x, Data_Clean: new_y};\n            source_clean.change.emit();\n\n            } // end of processing function\n\n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            setTimeout(processing, 1500);\n            setTimeout(StatusTextComplete, 1000);\n            }\n    \n        CallbackTiming()\n\n        \n    "}}]]]},"label":"Delete Selected Points"}},{"type":"object","name":"Button","id":"p77454","attributes":{"button_type":"warning","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p77455","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p77324"}],["status_label_cleaner",{"id":"p77448"}],["status_text_cleaner",{"id":"p77449"}]]},"code":"\n\n        function StatusTextLoading(){\n            status_text_cleaner.value = 'Undoing last delete ...'\n            status_label_cleaner.text = 'Undoing last delete ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner.value = 'Data processing complete.'    \n            status_label_cleaner.text = ' '\n            }\n\n\n        function processing(){\n            \n            var data = source_clean.data;\n            var x = data['DateTime_Clean'];\n            var y = data['Data_Clean'];\n            \n            var removed_x = window.removed_data['x'];\n            var removed_y = window.removed_data['y'];\n            \n            x = x.concat(removed_x); // this puts removed data at the end so need to sort!!\n            y = y.concat(removed_y);\n            \n            // sort data based on x (time)\n            let combined = [];\n            for (let i = 0; i &lt; y.length; i++) {\n              combined.push({ y: y[i], x: x[i] });\n            }\n            combined.sort((a, b) =&gt; a.x - b.x);\n            y = combined.map(point =&gt; point.y);\n            x = combined.map(point =&gt; point.x);\n            \n            // recompute cumulative total\n            source_clean.data = {'DateTime_Clean': x, 'Data_Clean': y};\n            \n            window.removed_data = null;\n            }\n        \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            setTimeout(processing, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n    \n        CallbackTiming()\n    "}}]]]},"label":"Undo Last Delete"}},{"type":"object","name":"Button","id":"p77456","attributes":{"js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p77457","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p77324"}],["source_raw",{"id":"p77321"}],["status_label_cleaner",{"id":"p77448"}],["status_text_cleaner",{"id":"p77449"}]]},"code":"\n\n                               function StatusTextLoading(){\n                                   status_text_cleaner.value = 'Restoring to raw data ...'\n                                   status_label_cleaner.text = 'Restoring to raw data ...'\n                                   }\n                               \n                               function StatusTextComplete(){\n                                   status_text_cleaner.value = 'Raw data restored.'    \n                                   status_label_cleaner.text = ' '\n                                   }\n\n                                function processing(){\n\n                                       var data = source_raw.data;\n                                       var x = data['DateTime_Raw'];\n                                       var y = data['Data_Raw'];\n                                       \n                                       // sort data based on x (time)\n                                       let combined = [];\n                                       for (let i = 0; i &lt; y.length; i++) {\n                                         combined.push({ y: y[i], x: x[i] });\n                                       }\n                                       combined.sort((a, b) =&gt; a.x - b.x);\n                                       y = combined.map(point =&gt; point.y);\n                                       x = combined.map(point =&gt; point.x);\n                                       \n                                    // update source\n                                    source_clean.data = {DateTime_Clean: x, Data_Clean: y};\n                                    source_clean.change.emit();\n                                   \n                                    }\n                                \n                                function CallbackTiming(){\n                                    setTimeout(StatusTextLoading,0);\n                                    setTimeout(processing, 1000);\n                                    setTimeout(StatusTextComplete, 1000);\n                                    }\n                            \n                                CallbackTiming()\n\n                               "}}]]]},"label":"Restore to Raw Data"}},{"type":"object","name":"Button","id":"p77458","attributes":{"button_type":"success","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p77459","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p77324"}],["status_label_cleaner",{"id":"p77448"}],["status_text_cleaner",{"id":"p77449"}],["csvfile_input",{"id":"p77450"}]]},"code":"\n\n                                  function StatusTextLoading(){\n                                      status_text_cleaner.value = 'Exporting cleaned data ...'\n                                      status_label_cleaner.value = 'Exporting cleaned data ...'\n                                      }\n                                  \n                                  function StatusTextComplete(){\n                                      status_text_cleaner.value = 'Data export complete.'    \n                                      status_label_cleaner.text = ' '\n                                      }\n\n                                   function processing(){\n                                        \n                                        var data = source_clean.data;\n                                        var x = data['DateTime_Clean'];\n                                        var y = data['Data_Clean'];\n                                \n                                        var csv_data = 'DateTime,Data_Cleaned\\n';\n                                        for (var i = 0; i &lt; x.length; i++) {\n                                            var date = new Date(x[i]);\n                                            var formatted_timestamp = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n                                            csv_data += formatted_timestamp + ',' + y[i] + '\\n';\n                                        }\n                                        \n                                        var blob = new Blob([csv_data], { type: 'text/csv;charset=utf-8;' });\n                                        var link = document.createElement(\"a\");\n                                        if (link.download !== undefined) {\n                                            link.setAttribute(\"href\", window.URL.createObjectURL(blob));\n                                            var csvFile = csvfile_input.filename.slice(0,csvfile_input.filename.length-4)+'_Cleaned.csv'\n                                            link.setAttribute(\"download\", csvFile);\n                                            link.style.visibility = 'hidden';\n                                            document.body.appendChild(link);\n                                            link.click();\n                                            document.body.removeChild(link);\n                                        }                                       \n                                        }\n                                   \n                                   function CallbackTiming(){\n                                       setTimeout(StatusTextLoading,0);\n                                       setTimeout(processing, 1000);\n                                       setTimeout(StatusTextComplete, 1000);\n                                       }\n                               \n                                   CallbackTiming()\n\n\n    "}}]]]},"label":"Export Cleaned Data"}},{"type":"object","name":"Button","id":"p77460","attributes":{"js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p77461","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p77324"}],["source_raw",{"id":"p77321"}],["status_label_cleaner",{"id":"p77448"}],["status_text_cleaner",{"id":"p77449"}],["plot_cleaner",{"id":"p77327"}],["csvfile_input",{"id":"p77450"}]]},"code":"\n\n                                    // update source\n                                    source_clean.data = {DateTime_Clean: [], Data_Clean: []};\n                                    source_clean.change.emit();\n\n                                    source_raw.data = {DateTime_Raw: [], Data_Raw: []};\n                                    source_raw.change.emit();\n                                    \n                                    plot_cleaner.title.text = ' ';\n\n                                   // csvfile_input.value = [ ];\n                                   status_text_cleaner.value = 'Waiting for a new file input. \\n To reload the previous file you need to first refresh the page.'\n                                   status_label_cleaner.text = 'Waiting for a new file input. \\n To reload the previous file you need to first refresh the page.'\n                                   \n                               "}}]]]},"label":"Clear All Data"}}]}}]}}]}}]}}
    </script>
    <script type="text/javascript">
      (function() {
        const fn = function() {
          Bokeh.safely(function() {
            (function(root) {
              function embed_document(root) {
              const docs_json = document.getElementById('p77686').textContent;
              const render_items = [{"docid":"d23653b9-81fe-46af-83b2-a15361baa5cf","roots":{"p77466":"abec51cc-d7db-4bab-bb67-8764e749878b"},"root_ids":["p77466"]}];
              root.Bokeh.embed.embed_items(docs_json, render_items);
              }
              if (root.Bokeh !== undefined) {
                embed_document(root);
              } else {
                let attempts = 0;
                const timer = setInterval(function(root) {
                  if (root.Bokeh !== undefined) {
                    clearInterval(timer);
                    embed_document(root);
                  } else {
                    attempts++;
                    if (attempts > 100) {
                      clearInterval(timer);
                      console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                    }
                  }
                }, 10, root)
              }
            })(window);
          });
        };
        if (document.readyState != "loading") fn();
        else document.addEventListener("DOMContentLoaded", fn);
      })();
    </script>
  </body>
</html>