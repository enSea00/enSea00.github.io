<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Rainfall Data Analyser</title>
<style>
      html, body {
        box-sizing: border-box;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-3.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.0.3.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
    
        <script type="text/javascript" src="MyCustomFunctions.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.0/papaparse.min.js"></script>
        
        <style>
    
            /* ---------- Page tabs styling -----------*/
            .bk-root .bk-tab {
                background-color: #15191C;
                color: white;
                opacity: 0.8;
                border-style: solid;
                outline_line_color: white;
            }
            
            .bk-root .bk-tabs-header .bk-tab.bk-active{
                background-color: lightskyblue;
                color: black;
                font-weight: bold;
                }
            
            .bk-root .bk-tabs-header .bk-tab:hover{
                background-color: lightsteelblue;
                }
            
            /* ---------- Font and Heading Styling -----------*/
            h1 {color: lightskyblue;}
            
            h2 {color: lightskyblue;}
            
            h3 {color: lightsteelblue;}
            
            body {
                background-color: #15191C;
                color: white;
                opacity: 0.8;
                }
            
            /* hyperlink styling */
            a:link {color: white;
                    }
            
            a:visited {color: white;
                       }
            
            a:hover {color: white;
                     }
            
            a:active {color: white;
                      }
            /* ------------ Toolbar icon styling ----------*/
            .bk-toolbar-button.bk-tool-icon-hover {display: none;}
            .bk-toolbar-button.bk-tool-icon-wheel-zoom {display: none;}
            .bk-toolbar-button.bk-tool-icon-tap-select {display: none;}
            .bk-toolbar-button.bk-tool-icon-pan {display: none;}
            
    
        </style>
  </head>
  <body>
    <div id="65ba0c3d-9da8-4d18-acb1-01e174d19313" data-root-id="p1849" style="display: contents;"></div>
  
    <script type="application/json" id="p3095">
      {"3b026170-7425-43fa-9bc2-8c69456f51ec":{"version":"3.0.3","title":"Bokeh Application","defs":[],"roots":[{"type":"object","name":"Tabs","id":"p1849","attributes":{"tabs":[{"type":"object","name":"TabPanel","id":"p1260","attributes":{"title":"BoM File Converter (bom2csv)","child":{"type":"object","name":"Row","id":"p1259","attributes":{"children":[{"type":"object","name":"Column","id":"p1257","attributes":{"width":550,"children":[{"type":"object","name":"Div","id":"p1256","attributes":{"text":"&lt;h1&gt;BoM Raw Rain Gauge Data File Converter&lt;/h1&gt;\n              &lt;p&gt;This app imports a raw (alert) rain gauge data file as provided by the Bureau of Meteorology (BoM) and then converts it to a .csv file with two columns [DateTime, Gauge Rainfall].&lt;/p&gt;&lt;br&gt;\n              &lt;p&gt;The created .csv file can then be loaded into the Data Cleaning app for data quality control&lt;/p&gt;&lt;br&gt;\n              &lt;p&gt;The raw BoM .txt file is assumed to have the following BoM Alert Station file format:&lt;/p&gt;&lt;br&gt;\n              &lt;p&gt; 540640      0 CURRUMBIN CK ALERT\t     16     16.0 20:03 16-01-2023 N&lt;/p&gt;&lt;br&gt;\n              &lt;p&gt;[StationID,  SensorNr, StationName, RawAccum, Rainfall(mm), LocalTime, VoidFlag]&lt;/p&gt;&lt;br&gt;\n\n              &lt;h2&gt;Open raw BoM rain gauge alert file (.txt):&lt;/h2&gt;\n              "}},{"type":"object","name":"FileInput","id":"p1254","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p1255","attributes":{"args":{"type":"map","entries":[["source_txt",{"type":"object","name":"ColumnDataSource","id":"p1049","attributes":{"selected":{"type":"object","name":"Selection","id":"p1050","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1051"},"data":{"type":"map","entries":[["DateTime_Raw",[]],["Rainfall_Raw",[]]]}}}],["status_text_convert",{"type":"object","name":"TextInput","id":"p1167","attributes":{"width":400,"title":"Status:","value":"Waiting for file input."}}],["status_label_convert",{"type":"object","name":"Label","id":"p1166","attributes":{"text":"Waiting for file input.","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"30px","text_align":"center","x":333,"x_units":"screen","y":200,"y_units":"screen"}}],["file_input_convert",{"id":"p1254"}],["plot_raw",{"type":"object","name":"Figure","id":"p1079","attributes":{"width":1000,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1080"},"y_range":{"type":"object","name":"DataRange1d","id":"p1081"},"x_scale":{"type":"object","name":"LinearScale","id":"p1093"},"y_scale":{"type":"object","name":"LinearScale","id":"p1095"},"title":{"type":"object","name":"Title","id":"p1082","attributes":{"text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1148","attributes":{"data_source":{"id":"p1049"},"view":{"type":"object","name":"CDSView","id":"p1149","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1150"}}},"glyph":{"type":"object","name":"Line","id":"p1145","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Raw"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1146","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Raw"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1147","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Raw"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1087","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1111"},{"type":"object","name":"BoxZoomTool","id":"p1112","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1113","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1114"},{"type":"object","name":"ResetTool","id":"p1115"},{"type":"object","name":"HoverTool","id":"p1164","attributes":{"renderers":[{"id":"p1148"}],"tooltips":[["Date Time","@DateTime_Raw{%H:%M %d/%m/%Y}"],["Rainfall_Raw","@Rainfall_Raw"]],"formatters":{"type":"map","entries":[["@DateTime_Raw","datetime"]]}}}],"active_drag":{"id":"p1112"},"active_scroll":{"id":"p1114"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1104","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1107","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1105"},"axis_label":"Raw Gauge Data","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1106"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1141","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p1163","attributes":{"label":{"type":"value","value":"Rainfall_Raw"},"renderers":[{"id":"p1148"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p1097","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1100","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1122","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1099"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1103","attributes":{"axis":{"id":"p1097"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1110","attributes":{"dimension":1,"axis":{"id":"p1104"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"id":"p1166"}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}],["plot_converted",{"type":"object","name":"Figure","id":"p1168","attributes":{"width":1000,"height":400,"x_range":{"id":"p1080"},"y_range":{"type":"object","name":"DataRange1d","id":"p1170"},"x_scale":{"type":"object","name":"LinearScale","id":"p1181"},"y_scale":{"type":"object","name":"LinearScale","id":"p1183"},"title":{"type":"object","name":"Title","id":"p1171","attributes":{"text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1236","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1052","attributes":{"selected":{"type":"object","name":"Selection","id":"p1053","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1054"},"data":{"type":"map","entries":[["DateTime_Raw",[]],["Rainfall_Converted",[]]]}}},"view":{"type":"object","name":"CDSView","id":"p1237","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1238"}}},"glyph":{"type":"object","name":"Line","id":"p1233","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Converted"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1234","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Converted"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1235","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Converted"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1176","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1199"},{"type":"object","name":"BoxZoomTool","id":"p1200","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1201","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1202"},{"type":"object","name":"ResetTool","id":"p1203"},{"type":"object","name":"HoverTool","id":"p1252","attributes":{"renderers":[{"id":"p1236"}],"tooltips":[["Date Time","@DateTime_Raw{%H:%M %d/%m/%Y}"],["Rainfall_Converted","@Rainfall_Converted"]],"formatters":{"type":"map","entries":[["@DateTime_Raw","datetime"]]}}}],"active_drag":{"id":"p1200"},"active_scroll":{"id":"p1202"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1192","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1195","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1193"},"axis_label":"Adjusted Gauge Data","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1194"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1229","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p1251","attributes":{"label":{"type":"value","value":"Rainfall_Converted"},"renderers":[{"id":"p1236"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p1185","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1188","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1210","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1187"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1191","attributes":{"axis":{"id":"p1185"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1198","attributes":{"dimension":1,"axis":{"id":"p1192"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}],["source_converted",{"id":"p1052"}]]},"code":"\n\n        function StatusTextLoading(){\n            status_text_convert.value = 'Loading data ...'\n            status_label_convert.text = 'Loading data ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_convert.value = 'File import complete.'    \n            status_label_convert.text = ' '\n            }\n\n        // file processing ////////////////////////////////////////////////////\n        function process_file() {\n\n            var file_contents = cb_obj.value;\n            \n            // read in entire file and decode text\n            const decoded_file_contents = atob(file_contents);\n            const file_lines = decoded_file_contents.split(\"\\n\");\n            \n            // initialise arrays        \n            var DateTime_Raw = [];\n            var Rainfall_Raw = [];\n            \n            // read the file data line by line   //////////////////////////////////\n            for (var i = 0; i &lt; file_lines.length; i++) {\n                \n                // read a line\n                var line = file_lines[i]\n                \n                // skip unwanted mid file headers    \n                if (line.indexOf('------') !== -1) {continue}\n                if (line.indexOf('Station') !== -1) {continue}\n                if (line.indexOf('Number') !== -1) {continue}\n                if (line.indexOf('rows selected') !== -1) {continue}\n                if (line.trim().length === 0 || line.trim() === \"\") {continue}\n                \n                // get the time series data\n                var tmp = line.split(' ')\n                var date = tmp[tmp.length-2]\n                var time = tmp[tmp.length-3]\n                var rain = parseFloat(tmp[tmp.length-4])\n                // this catches case where raw data column is empty in the current row\n                if (isNaN(rain)) {\n                    rain = parseFloat(tmp[tmp.length-5]); // get data from adjacent column\n                    if (isNaN(rain)) {continue}\n                    }\n                \n                // keep the data\n                Rainfall_Raw.push(rain);\n                \n                // parse Date\n                var tmp = date.split('-')\n                var year = tmp[2];\n                var month = tmp[1];\n                var day = tmp[0];\n\n                // parse time\n                var tmp = time.split(':')\n                var hours = tmp[0]\n                var minutes = tmp[1]\n                \n                // make DateTime\n                var tmp = new Date(year, month - 1, day, hours, minutes);\n                tmp = Math.floor(tmp.getTime()) // unix timestamp\n                DateTime_Raw.push(tmp)\n                \n                } // end of line by line loop\n\n            // reverse order because .txt is most recent to oldest\n            DateTime_Raw = DateTime_Raw.reverse()\n            Rainfall_Raw = Rainfall_Raw.reverse()\n\n            // update data source\n            source_txt.data = {DateTime_Raw: DateTime_Raw, Rainfall_Raw: Rainfall_Raw}; \n            source_txt.change.emit();\n\n            //\n            var data = source_txt.data;\n            var x = data['DateTime_Raw'];\n            var y = data['Rainfall_Raw'];\n            \n            // save csv file\n            var csv_data = 'DateTime, Rainfall\\n';\n            for (var i = 0; i &lt; x.length; i++) {\n                var date = new Date(x[i]);\n                var formatted_timestamp = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n                csv_data += formatted_timestamp + ',' + y[i] + '\\n';\n            }\n            \n            var blob = new Blob([csv_data], { type: 'text/csv;charset=utf-8;' });\n            var link = document.createElement(\"a\");\n            if (link.download !== undefined) {\n                link.setAttribute(\"href\", window.URL.createObjectURL(blob));\n                var csvFile = file_input_convert.filename.slice(0,file_input_convert.filename.length-4)+'.csv'\n                link.setAttribute(\"download\", csvFile);\n                link.style.visibility = 'hidden';\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n            }\n            \n        }  // end of proces_file function\n    \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            plot_raw.title.text = file_input_convert.filename;\n            setTimeout(process_file, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            \n            }\n    \n        CallbackTiming()\n        \n    "}}]]]},"width":400,"value":"","mime_type":"","filename":"","accept":".txt"}},{"id":"p1167"}]}},{"type":"object","name":"Column","id":"p1258","attributes":{"children":[{"id":"p1079"}]}}]}}}},{"type":"object","name":"TabPanel","id":"p1641","attributes":{"title":"Rainfall Data Cleaner","child":{"type":"object","name":"Row","id":"p1640","attributes":{"children":[{"type":"object","name":"Column","id":"p1637","attributes":{"width":650,"children":[{"type":"object","name":"Div","id":"p1634","attributes":{"text":"&lt;h1&gt;Rain Gauge Data Cleaner&lt;/h1&gt;\n\n              &lt;p&gt;This app can be used to undertake a quality control analysis and cleaning of raw, tipping bucket type rain gauge data.&lt;/p&gt;\n              \n              &lt;ol&gt;\n                  &lt;li&gt;Upload the raw gauge data.&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;The input csv file should have two columns [DateTime, Rainfall] with DateTime having the format: dd/mm/yyyy HH:MM:SS (eg see '.csv' file produced by the bom2csv file formatter app).&lt;/li&gt;\n                      &lt;li&gt;The data is then automatically pre-cleaned for obvious anomalies and for duplicate timestamp entries.&lt;/li&gt;\n                  &lt;/ul&gt;\n                  &lt;br&gt;\n                  &lt;li&gt;Manual quality control and data cleaning&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;User can manually clean the data by selecting data points with the Box Select Tool in the top figure and then clicking the Delete Selected Points button.&lt;/li&gt;\n                      &lt;li&gt;If available, a daily rainfall reference data set (e.g. from SILO) can be uploaded to compare with the daily amounts estimated from the raw data. &lt;/li&gt; \n                   &lt;/ul&gt;\n                   &lt;br&gt;\n                  &lt;li&gt;Export the cleaned data&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;click the Export Cleaned Data button.&lt;/li&gt;\n                  &lt;/ul&gt;\n              &lt;/ol&gt;\n              \n              &lt;h2&gt;Open raw rain gauge file (.csv):&lt;/h2&gt;\n              &lt;p&gt;&lt;i&gt;Note: &lt;/i&gt;File must consist of two columns: &lt;br&gt; [DateTime, Gauge Rainfall] with DateTime formatted as 'dd/mm/yyyy HH:MM:SS'&lt;/p&gt;\n              \n              "}},{"type":"object","name":"FileInput","id":"p1618","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p1619","attributes":{"args":{"type":"map","entries":[["source_raw",{"type":"object","name":"ColumnDataSource","id":"p1055","attributes":{"selected":{"type":"object","name":"Selection","id":"p1056","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1057"},"data":{"type":"map","entries":[["DateTime_Raw",[]],["Rainfall_Raw",[]]]}}}],["source_clean",{"type":"object","name":"ColumnDataSource","id":"p1058","attributes":{"selected":{"type":"object","name":"Selection","id":"p1059","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1060"},"data":{"type":"map","entries":[["DateTime_Clean",[]],["Rainfall_Clean",[]],["Cumulative_Clean",[]]]}}}],["source_precleaned",{"type":"object","name":"ColumnDataSource","id":"p1061","attributes":{"selected":{"type":"object","name":"Selection","id":"p1062","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1063"},"data":{"type":"map","entries":[["DateTime_Clean",[]],["Rainfall_Clean",[]],["Cumulative_Clean",[]]]}}}],["source_daily",{"type":"object","name":"ColumnDataSource","id":"p1067","attributes":{"selected":{"type":"object","name":"Selection","id":"p1068","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1069"},"data":{"type":"map","entries":[["DateTime_Daily",[]],["Cumulative_Daily",[]],["Daily",[]]]}}}],["status_text_cleaner",{"type":"object","name":"TextInput","id":"p1381","attributes":{"width":400,"title":"Status:","value":"Waiting for file input."}}],["status_label_cleaner",{"type":"object","name":"Label","id":"p1380","attributes":{"text":"Waiting for file input.","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"30px","text_align":"center","x":333,"x_units":"screen","y":200,"y_units":"screen"}}],["csvfile_input",{"id":"p1618"}],["plot_cleaner",{"type":"object","name":"Figure","id":"p1261","attributes":{"width":1000,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1262"},"y_range":{"type":"object","name":"DataRange1d","id":"p1263"},"x_scale":{"type":"object","name":"LinearScale","id":"p1275"},"y_scale":{"type":"object","name":"LinearScale","id":"p1277"},"title":{"type":"object","name":"Title","id":"p1264","attributes":{"text":" ","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1330","attributes":{"data_source":{"id":"p1055"},"view":{"type":"object","name":"CDSView","id":"p1331","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1332"}}},"glyph":{"type":"object","name":"Line","id":"p1327","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Raw"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1328","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Raw"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1329","attributes":{"x":{"type":"field","field":"DateTime_Raw"},"y":{"type":"field","field":"Rainfall_Raw"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1354","attributes":{"data_source":{"id":"p1058"},"view":{"type":"object","name":"CDSView","id":"p1355","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1356"}}},"glyph":{"type":"object","name":"Circle","id":"p1351","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Rainfall_Clean"},"line_color":{"type":"value","value":"#ff7f0e"},"fill_color":{"type":"value","value":"#ff7f0e"},"fill_alpha":{"type":"value","value":0},"hatch_color":{"type":"value","value":"#ff7f0e"}}},"nonselection_glyph":{"type":"object","name":"Circle","id":"p1352","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Rainfall_Clean"},"line_color":{"type":"value","value":"#ff7f0e"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"#ff7f0e"},"fill_alpha":{"type":"value","value":0.1},"hatch_color":{"type":"value","value":"#ff7f0e"},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Circle","id":"p1353","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Rainfall_Clean"},"line_color":{"type":"value","value":"#ff7f0e"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"#ff7f0e"},"fill_alpha":{"type":"value","value":0.2},"hatch_color":{"type":"value","value":"#ff7f0e"},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1269","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1293"},{"type":"object","name":"BoxZoomTool","id":"p1294","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1295","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1296"},{"type":"object","name":"ResetTool","id":"p1297"},{"type":"object","name":"HoverTool","id":"p1346","attributes":{"renderers":[{"id":"p1330"}],"tooltips":[["Date Time","@DateTime_Raw{%H:%M %d/%m/%Y}"],["Rainfall_Raw","@Rainfall_Raw"]],"formatters":{"type":"map","entries":[["@DateTime_Raw","datetime"]]}}},{"type":"object","name":"HoverTool","id":"p1375","attributes":{"renderers":[{"id":"p1354"}],"tooltips":[["Date Time","@DateTime_Clean{%H:%M %d/%m/%Y}"],["Rainfall_Clean","@Rainfall_Clean"]],"formatters":{"type":"map","entries":[["@DateTime_Clean","datetime"]]}}},{"type":"object","name":"BoxSelectTool","id":"p1377","attributes":{"renderers":[{"id":"p1354"}],"overlay":{"type":"object","name":"BoxAnnotation","id":"p1378","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}}],"active_drag":{"id":"p1294"},"active_scroll":{"id":"p1296"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1286","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1289","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1287"},"axis_label":"Raw Gauge Data","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1288"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1323","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"click_policy":"hide","label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p1345","attributes":{"label":{"type":"value","value":"Rainfall_Raw"},"renderers":[{"id":"p1330"}]}},{"type":"object","name":"LegendItem","id":"p1374","attributes":{"label":{"type":"value","value":"Rainfall_Clean"},"renderers":[{"id":"p1354"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p1279","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1282","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1304","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1281"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1285","attributes":{"axis":{"id":"p1279"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1292","attributes":{"dimension":1,"axis":{"id":"p1286"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"id":"p1380"}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}]]},"code":"\n    \n        function StatusTextLoading(){\n            status_text_cleaner.value = 'Loading raw data file and pre-cleaning data ...'\n            status_label_cleaner.text = 'Loading raw data file and pre-cleaning data ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner.value = 'File import and pre-cleaning complete.'    \n            status_label_cleaner.text = ' '\n            }\n    \n    \n        // file loading ////////////////////////////////////////////////////\n        function process_file() {\n    \n            var file_contents = cb_obj.value;\n            \n            // read in entire file and decode text\n            const decoded_file_contents = atob(file_contents);\n            const file_lines = decoded_file_contents.split(\"\\n\");\n            \n            // initialise arrays        \n            var DateTime_Raw = [];\n            var Rainfall_Raw = [];\n            \n            // read the file data line by line   //////////////////////////////////\n            for (var i = 1; i &lt; file_lines.length; i++) {\n                \n                // read a line\n                var line = file_lines[i]\n                \n                // checks\n                if (line.trim().length === 0 || line.trim() === \"\") {continue}\n                \n                // get the time series data\n                var tmp = line.split(',')\n\n                var rain = parseFloat(tmp[1])\n                Rainfall_Raw.push(rain);\n\n                // parse date time\n                // tmp[0] = 4/07/2005 9:33\n                var datetime_string = tmp[0];\n                var date_parts = datetime_string.split(\" \")[0].split(\"/\");\n                var time_parts = datetime_string.split(\" \")[1].split(\":\");\n                var datetime = new Date(date_parts[2], date_parts[1] - 1, date_parts[0], time_parts[0], time_parts[1]);\n                datetime = Math.floor(datetime.getTime()) // unix timestamp\n                DateTime_Raw.push(datetime)\n                \n                } // end of line by line loop\n    \n            // create data source\n            source_raw.data = {DateTime_Raw: DateTime_Raw, Rainfall_Raw: Rainfall_Raw}; \n            source_raw.change.emit();\n\n            // automatic pre-cleaning to remove obvious anomalies /////////////////////////////\n            console.log('  Pre-clean data ...')\n            const inc_threshold = 2 //mm\n            const intensity_threshold = 200 // mm/hr\n            var DateTime_Clean = []\n            var Data_Clean = []\n            for (var ii=1; ii&lt;Rainfall_Raw.length-1; ii++){  // so note that the first and last values of raw data are dropped\n               \n                // get rainfall increment\n                const inc_back = Rainfall_Raw[ii] - Rainfall_Raw[ii-1]\n                const inc_forward = Rainfall_Raw[ii] - Rainfall_Raw[ii+1]\n                \n                // catch anomalous intensity\n                const inc_time = DateTime_Raw[ii+1]/3600000 - DateTime_Raw[ii]/3600000\n                const intensity = -inc_forward/inc_time\n                if (intensity &gt; intensity_threshold) {console.log('here33')\n                                                      console.log(DateTime_Raw[ii+1], intensity_threshold, intensity)\n                                                      continue}\n                \n    \n                //catch up down anomaly above trend\n                if (inc_back &gt; inc_threshold &amp;&amp; inc_forward &gt; inc_threshold) {continue}\n    \n                // catch down up anomaly below trend\n                if (inc_back &lt; -inc_threshold &amp;&amp; inc_forward &lt; -inc_threshold) {continue}\n    \n                // keep good data\n                DateTime_Clean.push(DateTime_Raw[ii])\n                Data_Clean.push(Rainfall_Raw[ii])\n                \n                } // end of ii for loop\n    \n            // remove non-unique values - keeps last occurrence ///////////////////\n            let numbers = DateTime_Clean; \n            let [uniqueWithLastOccurrence, indices] = getUniqueWithLastOccurrence(numbers);\n            DateTime_Clean = subsetArray(DateTime_Clean,indices)\n            Data_Clean = subsetArray(Data_Clean,indices)\n            \n            // compute cumulative /////////////////////////////////////////////////\n            var Cumulative_Clean = cumulative(Data_Clean)\n    \n            // update sources /////////////////////////////////////////////////////\n            source_clean.data = {DateTime_Clean: DateTime_Clean, Rainfall_Clean: Data_Clean, Cumulative_Clean: Cumulative_Clean};\n            source_clean.change.emit();\n            source_precleaned.data = source_clean.data;\n            source_precleaned.change.emit();\n    \n           /////////////////////////////////////////////////////////////////////////             \n            // compute daily accumulations via interpolation of curve\n            // day is to 9am, consistent with SILO\n            let [DateTime_Daily, Cumulative_Daily, Daily]  = ComputeDailyRainfall(DateTime_Clean, Cumulative_Clean);\n            \n            // update source_daily\n            source_daily.data = {DateTime_Daily: DateTime_Daily, Cumulative_Daily: Cumulative_Daily, Daily: Daily}; \n            source_daily.change.emit();\n            \n        }  // end of process_file function\n    \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            plot_cleaner.title.text = csvfile_input.filename;\n            setTimeout(process_file, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n        \n        CallbackTiming()\n        \n    "}}]]]},"width":400,"value":"","mime_type":"","filename":"","accept":".csv"}},{"id":"p1381"},{"type":"object","name":"Spacer","id":"p1636"},{"type":"object","name":"Div","id":"p1635","attributes":{"text":"&lt;h2&gt;Open SILO daily rainfal reference data (.txt):&lt;/h2&gt;"}},{"type":"object","name":"FileInput","id":"p1632","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p1633","attributes":{"args":{"type":"map","entries":[["source_silo",{"type":"object","name":"ColumnDataSource","id":"p1070","attributes":{"selected":{"type":"object","name":"Selection","id":"p1071","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1072"},"data":{"type":"map","entries":[["DateTime_Silo",[]],["DailyRainfall_Silo",[]]]}}}],["status_text_cleaner_silo",{"type":"object","name":"TextInput","id":"p1588","attributes":{"width":400,"title":"Status:","value":"Waiting for SILO file input."}}],["status_label_cleaner_silo",{"type":"object","name":"Label","id":"p1587","attributes":{"text":"Waiting for SILO file input.","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"30px","text_align":"center","x":333,"x_units":"screen","y":100,"y_units":"screen"}}],["plot_Daily_cleaner",{"type":"object","name":"Figure","id":"p1500","attributes":{"width":1000,"height":200,"x_range":{"id":"p1262"},"y_range":{"type":"object","name":"DataRange1d","id":"p1502"},"x_scale":{"type":"object","name":"LinearScale","id":"p1513"},"y_scale":{"type":"object","name":"LinearScale","id":"p1515"},"title":{"type":"object","name":"Title","id":"p1503","attributes":{"text":" ","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1569","attributes":{"data_source":{"id":"p1070"},"view":{"type":"object","name":"CDSView","id":"p1570","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1571"}}},"glyph":{"type":"object","name":"VBar","id":"p1566","attributes":{"x":{"type":"field","field":"DateTime_Silo"},"width":{"type":"value","value":86400000.0},"top":{"type":"field","field":"DailyRainfall_Silo"},"line_color":{"type":"value","value":"#ff9896"},"fill_color":{"type":"value","value":"#ff9896"},"fill_alpha":{"type":"value","value":0.2}}},"nonselection_glyph":{"type":"object","name":"VBar","id":"p1567","attributes":{"x":{"type":"field","field":"DateTime_Silo"},"width":{"type":"value","value":86400000.0},"top":{"type":"field","field":"DailyRainfall_Silo"},"line_color":{"type":"value","value":"#ff9896"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"#ff9896"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"VBar","id":"p1568","attributes":{"x":{"type":"field","field":"DateTime_Silo"},"width":{"type":"value","value":86400000.0},"top":{"type":"field","field":"DailyRainfall_Silo"},"line_color":{"type":"value","value":"#ff9896"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"#ff9896"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1595","attributes":{"data_source":{"id":"p1067"},"view":{"type":"object","name":"CDSView","id":"p1596","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1597"}}},"glyph":{"type":"object","name":"VBar","id":"p1592","attributes":{"x":{"type":"field","field":"DateTime_Daily"},"width":{"type":"value","value":86400000.0},"top":{"type":"field","field":"Daily"},"line_color":{"type":"value","value":"#98df8a"},"fill_color":{"type":"value","value":"#98df8a"},"fill_alpha":{"type":"value","value":0.2}}},"nonselection_glyph":{"type":"object","name":"VBar","id":"p1593","attributes":{"x":{"type":"field","field":"DateTime_Daily"},"width":{"type":"value","value":86400000.0},"top":{"type":"field","field":"Daily"},"line_color":{"type":"value","value":"#98df8a"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"#98df8a"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"VBar","id":"p1594","attributes":{"x":{"type":"field","field":"DateTime_Daily"},"width":{"type":"value","value":86400000.0},"top":{"type":"field","field":"Daily"},"line_color":{"type":"value","value":"#98df8a"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"#98df8a"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1508","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1531"},{"type":"object","name":"BoxZoomTool","id":"p1532","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1533","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1534"},{"type":"object","name":"ResetTool","id":"p1535"},{"type":"object","name":"HoverTool","id":"p1585","attributes":{"renderers":[{"id":"p1569"}],"tooltips":[["Date Time","@DateTime_Silo{%H:%M %d/%m/%Y}"],["DailyRainfall_Silo","@DailyRainfall_Silo{0.2f}"]],"formatters":{"type":"map","entries":[["@DateTime_Silo","datetime"]]}}},{"type":"object","name":"HoverTool","id":"p1616","attributes":{"renderers":[{"id":"p1595"}],"tooltips":[["Date Time","@DateTime_Daily{%H:%M %d/%m/%Y}"],["Daily_Interp","@Daily{0.2f}"]],"formatters":{"type":"map","entries":[["@DateTime_Daily","datetime"]]}}}],"active_drag":{"id":"p1532"},"active_scroll":{"id":"p1534"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1524","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1527","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1525"},"axis_label":"Daily","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1526"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1561","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"click_policy":"hide","label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p1584","attributes":{"label":{"type":"value","value":"Daily_SILO"},"renderers":[{"id":"p1569"}]}},{"type":"object","name":"LegendItem","id":"p1615","attributes":{"label":{"type":"value","value":"Daily_Interp"},"renderers":[{"id":"p1595"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p1517","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1520","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1542","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1519"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1523","attributes":{"axis":{"id":"p1517"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1530","attributes":{"dimension":1,"axis":{"id":"p1524"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"id":"p1587"}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}],["SILOfile_input",{"id":"p1632"}]]},"code":"\n    \n        function StatusTextLoading(){\n            status_text_cleaner_silo.value = 'Loading SILO ref data file ...'\n            status_label_cleaner_silo.text = 'Loading SILO ref data file ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner_silo.value = 'SILO File import and pre-cleaning complete.'    \n            status_label_cleaner_silo.text = ' '\n            }\n    \n    \n        // file loading ////////////////////////////////////////////////////\n        function process_file() {\n    \n            var file_contents = cb_obj.value;\n            \n            // read in entire file and decode text\n            const decoded_file_contents = atob(file_contents);\n            const file_lines = decoded_file_contents.split(\"\\n\");\n            \n            // initialise arrays        \n            var DateTime_Silo = [];\n            var DailyRainfall_Silo = [];\n            \n            // read the file data line by line   //////////////////////////////////\n            console.log('  Read file line by line ...')\n            for (var i = 1; i &lt; file_lines.length; i++) {\n            //for (var i = 0; i &lt; 20; i++) {\n                \n                // read a line\n                var line = file_lines[i]\n                line = line.replace('\\r','')\n                // SILO line format 2010  1  1    1      2.6\n                //                  2021 12 31  365      2.6\n                \n                // checks\n                if (line.trim().length === 0 || line.trim() === \"\") {continue}\n                \n                // get the time series data\n                var tmp = line.split(' ')\n                tmp = tmp.filter((str) =&gt; str !== ''); // remove empty strings in split array\n                var rain = parseFloat(tmp[4])\n                DailyRainfall_Silo.push(rain);\n                \n                // make DateTime\n                var year = tmp[0];\n                var month = tmp[1];\n                var day = tmp[2];\n                var hours = 19;  // for 9am + 10hrs GMT\n                var minutes = 0;\n                var tmp = new Date(year, month - 1, day, hours, minutes);\n                console.log(tmp)\n                tmp = Math.floor(tmp.getTime()); // unix timestamp\n                DateTime_Silo.push(tmp)\n\n                } // end of line by line loop\n    \n            // create data source\n            source_silo.data = {DateTime_Silo: DateTime_Silo, DailyRainfall_Silo: DailyRainfall_Silo}; \n            source_silo.change.emit();\n\n            \n        }  // end of process_file function\n    \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            plot_Daily_cleaner.title.text = SILOfile_input.filename;\n            setTimeout(process_file, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n        \n        CallbackTiming()\n        \n    "}}]]]},"width":400,"value":"","mime_type":"","filename":"","accept":".txt"}}]}},{"type":"object","name":"Column","id":"p1639","attributes":{"children":[{"id":"p1261"},{"type":"object","name":"Row","id":"p1638","attributes":{"align":"end","children":[{"type":"object","name":"Button","id":"p1620","attributes":{"button_type":"danger","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1621","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p1058"}],["source_daily",{"id":"p1067"}],["status_label_cleaner",{"id":"p1380"}],["status_text_cleaner",{"id":"p1381"}]]},"code":"\n                               \n        function StatusTextLoading(){\n            status_text_cleaner.value = 'Reprocessing data ...'\n            status_label_cleaner.text = 'Reprocessing data ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner.value = 'Data processing complete.'    \n            status_label_cleaner.text = ' '\n            }\n\n        function processing(){\n                                           \n            var indices = source_clean.selected.indices;\n            if (indices.length == 0) {\n                return;\n            }\n            \n            // declare variables        \n            var data = source_clean.data;\n            var x = data['DateTime_Clean'];\n            var y = data['Rainfall_Clean'];\n            var removed_x = [];\n            var removed_y = [];\n            \n            // remove data and store for later recovery\n            for (var i = 0; i &lt; indices.length; i++) {\n                removed_x.push(x[indices[i]]);\n                removed_y.push(y[indices[i]]);\n            }\n            window.removed_data = {'x': removed_x, 'y': removed_y};\n            \n            \n            var new_x = [];\n            var new_y = [];\n            for (var i = 0; i &lt; x.length; i++) {\n                if (indices.indexOf(i) == -1) {\n                    new_x.push(x[i]);\n                    new_y.push(y[i]);\n                }\n            }\n            \n            // compute cumulative total\n            var new_c = cumulative(new_y)\n            source_clean.data = {'DateTime_Clean': new_x, 'Rainfall_Clean': new_y, 'Cumulative_Clean':new_c};\n            source_clean.selected.indices = [];\n            \n            // \n\n            // ComputeDaily(source_clean, source_daily)\n            let [DateTime_Daily, Cumulative_Daily, Daily]  = ComputeDailyRainfall(new_x, new_c);\n            \n            // update source_daily\n            source_daily.data = {DateTime_Daily: DateTime_Daily, Cumulative_Daily: Cumulative_Daily, Daily: Daily}; \n            source_daily.change.emit();\n            \n\n            } // end of processing function\n\n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            setTimeout(processing, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n    \n        CallbackTiming()\n\n        \n    "}}]]]},"label":"Delete Selected Points"}},{"type":"object","name":"Button","id":"p1622","attributes":{"button_type":"warning","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1623","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p1058"}],["source_daily",{"id":"p1067"}],["status_label_cleaner",{"id":"p1380"}],["status_text_cleaner",{"id":"p1381"}]]},"code":"\n\n        function StatusTextLoading(){\n            status_text_cleaner.value = 'Undoing last delete ...'\n            status_label_cleaner.text = 'Undoing last delete ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_cleaner.value = 'Data processing complete.'    \n            status_label_cleaner.text = ' '\n            }\n\n\n        function processing(){\n            \n            var data = source_clean.data;\n            var x = data['DateTime_Clean'];\n            var y = data['Rainfall_Clean'];\n            \n            var removed_x = window.removed_data['x'];\n            var removed_y = window.removed_data['y'];\n            \n            x = x.concat(removed_x); // this puts removed data at the end so need to sort!!\n            y = y.concat(removed_y);\n            \n            // sort data based on x (time)\n            let combined = [];\n            for (let i = 0; i &lt; y.length; i++) {\n              combined.push({ y: y[i], x: x[i] });\n            }\n            combined.sort((a, b) =&gt; a.x - b.x);\n            y = combined.map(point =&gt; point.y);\n            x = combined.map(point =&gt; point.x);\n            \n            // recompute cumulative total\n            var c = cumulative(y)\n            source_clean.data = {'DateTime_Clean': x, 'Rainfall_Clean': y, 'Cumulative_Clean': c};\n            \n            // \n            ComputeDaily(source_clean, source_daily)\n    \n            window.removed_data = null;\n            }\n        \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            setTimeout(processing, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n    \n        CallbackTiming()\n    "}}]]]},"label":"Undo Last Delete"}},{"type":"object","name":"Button","id":"p1624","attributes":{"button_type":"primary","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1625","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p1058"}],["source_precleaned",{"id":"p1061"}],["source_daily",{"id":"p1067"}],["status_label_cleaner",{"id":"p1380"}],["status_text_cleaner",{"id":"p1381"}]]},"code":"\n                               \n                                    function StatusTextLoading(){\n                                        status_text_cleaner.value = 'Restoring pre-cleaned data ...'\n                                        status_label_cleaner.text = 'Restoring pre-cleaned data ...'\n                                        }\n                                    \n                                    function StatusTextComplete(){\n                                        status_text_cleaner.value = 'Pre-cleaned data restored.'    \n                                        status_label_cleaner.text = ' '\n                                        }\n                                    \n                                    function processing(){\n                                        source_clean.data = source_precleaned.data;\n                                        source_clean.change.emit();\n                                        ComputeDaily(source_clean, source_daily)\n                                            } // end of processing\n                                    \n                                     function CallbackTiming(){\n                                         setTimeout(StatusTextLoading,0);\n                                         setTimeout(processing, 1000);\n                                         setTimeout(StatusTextComplete, 1000);\n                                         }\n                                     \n                                     CallbackTiming()\n                                       \n                                     "}}]]]},"label":"Restore to Pre-Cleaned Data"}},{"type":"object","name":"Button","id":"p1626","attributes":{"js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1627","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p1058"}],["source_raw",{"id":"p1055"}],["source_daily",{"id":"p1067"}],["status_label_cleaner",{"id":"p1380"}],["status_text_cleaner",{"id":"p1381"}]]},"code":"\n\n                               function StatusTextLoading(){\n                                   status_text_cleaner.value = 'Restoring to raw data ...'\n                                   status_label_cleaner.text = 'Restoring to raw data ...'\n                                   }\n                               \n                               function StatusTextComplete(){\n                                   status_text_cleaner.value = 'Raw data restored.'    \n                                   status_label_cleaner.text = ' '\n                                   }\n\n                                function processing(){\n\n                                       var data = source_raw.data;\n                                       var x = data['DateTime_Raw'];\n                                       var y = data['Rainfall_Raw'];\n                                       \n                                       // sort data based on x (time)\n                                       let combined = [];\n                                       for (let i = 0; i &lt; y.length; i++) {\n                                         combined.push({ y: y[i], x: x[i] });\n                                       }\n                                       combined.sort((a, b) =&gt; a.x - b.x);\n                                       y = combined.map(point =&gt; point.y);\n                                       x = combined.map(point =&gt; point.x);\n                                       \n                                       // recompute cumulative total\n                                       var c = cumulative(y);\n                                       \n                                    // update source\n                                    source_clean.data = {DateTime_Clean: x, Rainfall_Clean: y, Cumulative_Clean: c};\n                                    source_clean.change.emit();\n                                   \n                                    // \n                                    ComputeDaily(source_clean, source_daily)\n                                    }\n                                \n                                function CallbackTiming(){\n                                    setTimeout(StatusTextLoading,0);\n                                    setTimeout(processing, 1000);\n                                    setTimeout(StatusTextComplete, 1000);\n                                    }\n                            \n                                CallbackTiming()\n\n                               "}}]]]},"label":"Restore to Raw Data"}},{"type":"object","name":"Button","id":"p1628","attributes":{"button_type":"success","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1629","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p1058"}],["status_label_cleaner",{"id":"p1380"}],["status_text_cleaner",{"id":"p1381"}],["csvfile_input",{"id":"p1618"}]]},"code":"\n\n                                  function StatusTextLoading(){\n                                      status_text_cleaner.value = 'Exporting cleaned data ...'\n                                      status_label_cleaner.value = 'Exporting cleaned data ...'\n                                      }\n                                  \n                                  function StatusTextComplete(){\n                                      status_text_cleaner.value = 'Data export complete.'    \n                                      status_label_cleaner.text = ' '\n                                      }\n\n                                   function processing(){\n                                        \n                                        var data = source_clean.data;\n                                        var x = data['DateTime_Clean'];\n                                        var y = data['Rainfall_Clean'];\n                                        var c = data['Cumulative_Clean'];\n                                        \n                                \n                                        var csv_data = 'DateTime,Cumulative Rainfall\\n';\n                                        for (var i = 0; i &lt; x.length; i++) {\n                                            var date = new Date(x[i]);\n                                            var formatted_timestamp = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n                                            csv_data += formatted_timestamp + ',' + c[i] + '\\n';\n                                        }\n                                        \n                                        var blob = new Blob([csv_data], { type: 'text/csv;charset=utf-8;' });\n                                        var link = document.createElement(\"a\");\n                                        if (link.download !== undefined) {\n                                            link.setAttribute(\"href\", window.URL.createObjectURL(blob));\n                                            var csvFile = csvfile_input.filename.slice(0,csvfile_input.filename.length-4)+'_Cleaned.csv'\n                                            link.setAttribute(\"download\", csvFile);\n                                            link.style.visibility = 'hidden';\n                                            document.body.appendChild(link);\n                                            link.click();\n                                            document.body.removeChild(link);\n                                        }                                       \n                                        }\n                                   \n                                   function CallbackTiming(){\n                                       setTimeout(StatusTextLoading,0);\n                                       setTimeout(processing, 1000);\n                                       setTimeout(StatusTextComplete, 1000);\n                                       }\n                               \n                                   CallbackTiming()\n\n\n    "}}]]]},"label":"Export Cleaned Data"}},{"type":"object","name":"Button","id":"p1630","attributes":{"js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1631","attributes":{"args":{"type":"map","entries":[["source_clean",{"id":"p1058"}],["source_raw",{"id":"p1055"}],["source_daily",{"id":"p1067"}],["status_label_cleaner",{"id":"p1380"}],["status_text_cleaner",{"id":"p1381"}],["plot_cleaner",{"id":"p1261"}],["csvfile_input",{"id":"p1618"}]]},"code":"\n\n                                    // update source\n                                    source_clean.data = {DateTime_Clean: [], Rainfall_Clean: [], Cumulative_Clean: []};\n                                    source_clean.change.emit();\n\n                                    source_raw.data = {DateTime_Raw: [], Rainfall_Raw: []};\n                                    source_raw.change.emit();\n                                    \n                                    source_daily.data = {DateTime_Daily: [], Cumulative_Daily: [], Daily: []};\n                                    source_daily.change.emit();\n\n                                    plot_cleaner.title.text = ' ';\n\n                                   // csvfile_input.value = [ ];\n                                   status_text_cleaner.value = 'Waiting for a new file input. \\n To reload the previous file you need to first refresh the page.'\n                                   status_label_cleaner.text = 'Waiting for a new file input. \\n To reload the previous file you need to first refresh the page.'\n                                   \n                                   //var new_file_input = new Bokeh.Models.FileInput({accept: \".csv\", id: \"file-input\" + new Date().getTime()});\n                                   //csvfile_input = new_file_input;\n\n                               "}}]]]},"label":"Clear All Data"}}]}},{"type":"object","name":"Figure","id":"p1382","attributes":{"width":1000,"height":200,"x_range":{"id":"p1262"},"y_range":{"type":"object","name":"DataRange1d","id":"p1384"},"x_scale":{"type":"object","name":"LinearScale","id":"p1394"},"y_scale":{"type":"object","name":"LinearScale","id":"p1396"},"title":{"type":"object","name":"Title","id":"p1386","attributes":{"text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1451","attributes":{"data_source":{"id":"p1058"},"view":{"type":"object","name":"CDSView","id":"p1452","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1453"}}},"glyph":{"type":"object","name":"Line","id":"p1448","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Cumulative_Clean"},"line_color":"#ff7f0e","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1449","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Cumulative_Clean"},"line_color":"#ff7f0e","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1450","attributes":{"x":{"type":"field","field":"DateTime_Clean"},"y":{"type":"field","field":"Cumulative_Clean"},"line_color":"#ff7f0e","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1476","attributes":{"data_source":{"id":"p1067"},"view":{"type":"object","name":"CDSView","id":"p1477","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1478"}}},"glyph":{"type":"object","name":"Line","id":"p1473","attributes":{"x":{"type":"field","field":"DateTime_Daily"},"y":{"type":"field","field":"Cumulative_Daily"},"line_color":"#98df8a","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1474","attributes":{"x":{"type":"field","field":"DateTime_Daily"},"y":{"type":"field","field":"Cumulative_Daily"},"line_color":"#98df8a","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1475","attributes":{"x":{"type":"field","field":"DateTime_Daily"},"y":{"type":"field","field":"Cumulative_Daily"},"line_color":"#98df8a","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1389","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1412"},{"type":"object","name":"BoxZoomTool","id":"p1413","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1414","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1415"},{"type":"object","name":"ResetTool","id":"p1416"},{"type":"object","name":"HoverTool","id":"p1468","attributes":{"renderers":[{"id":"p1451"}],"tooltips":[["Date Time","@DateTime_Clean{%H:%M %d/%m/%Y}"],["Cumulative_Clean","@Cumulative_Clean{0.1f}"]],"formatters":{"type":"map","entries":[["@DateTime_Clean","datetime"]]}}},{"type":"object","name":"HoverTool","id":"p1498","attributes":{"renderers":[{"id":"p1476"}],"tooltips":[["Date Time","@DateTime_Daily{%H:%M %d/%m/%Y}"],["Cumulative_Daily","@Cumulative_Daily{0.1f}"]],"formatters":{"type":"map","entries":[["@DateTime_Daily","datetime"]]}}}],"active_drag":{"id":"p1413"},"active_scroll":{"id":"p1415"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1405","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1408","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1406"},"axis_label":"Cumulative Rainfall","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1407"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1444","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"click_policy":"hide","label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p1467","attributes":{"label":{"type":"value","value":"Cumulative_Clean"},"renderers":[{"id":"p1451"}]}},{"type":"object","name":"LegendItem","id":"p1497","attributes":{"label":{"type":"value","value":"Cumulative_Daily"},"renderers":[{"id":"p1476"}]}}]}},{"type":"object","name":"Legend","id":"p1562","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8}}],"below":[{"type":"object","name":"LinearAxis","id":"p1398","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1401","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1423","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1400"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1404","attributes":{"axis":{"id":"p1398"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1411","attributes":{"dimension":1,"axis":{"id":"p1405"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}},{"id":"p1500"}]}}]}}}},{"type":"object","name":"TabPanel","id":"p1848","attributes":{"title":"Rainfall Data Interpolator","child":{"type":"object","name":"Row","id":"p1847","attributes":{"children":[{"type":"object","name":"Column","id":"p1845","attributes":{"width":550,"children":[{"type":"object","name":"Div","id":"p1843","attributes":{"text":"&lt;h1&gt;Rainfall Data Interpolator&lt;/h1&gt;\n              \n              &lt;p&gt;This app temporally interpolates a cumulative mass curve according to a user supplied time increment (hours)&lt;/p&gt;\n              \n              &lt;ol&gt;\n                  &lt;li&gt;Load cumulative rainfall data&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;Open a two column .csv file containing the cumulative rainfall data [DateTime, Cum,ulativce Rainfall]&lt;/li&gt;\n                      &lt;li&gt; (e.g. as created by the Rainfall Data Cleaner app).&lt;/li&gt;\n                  &lt;/ul&gt;\n                  &lt;br&gt;\n\n                  &lt;li&gt;Specify the interpolation time interval (hours)&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;The cumulative mass curve is then interpolated and the corresponding incremental data time series is created&lt;/li&gt;\n                  &lt;/ul&gt;\n                  &lt;br&gt;\n\n                  &lt;li&gt;Export the interpolated data&lt;/li&gt;\n                  &lt;ul&gt;\n                      &lt;li&gt;A .csv file is exported with three columns [DateTime, Cumulative, Incremental]&lt;/li&gt;\n                  &lt;/ul&gt;\n              &lt;/ol&gt;\n              \n              &lt;h2&gt;1. Load input cumulative rainfall data file (.csv):&lt;/h2&gt;\n              &lt;p&gt;&lt;i&gt;e.g. a file exported from the Rainfall Data Cleaner tab&lt;/i&gt;&lt;/p&gt;&lt;br&gt;\n              \n              "}},{"type":"object","name":"FileInput","id":"p1835","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p1837","attributes":{"args":{"type":"map","entries":[["source_preinterp_inc",{"type":"object","name":"ColumnDataSource","id":"p1073","attributes":{"selected":{"type":"object","name":"Selection","id":"p1074","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1075"},"data":{"type":"map","entries":[["DateTime_Input",[]],["Cumulative_Input",[]]]}}}],["source_interp",{"type":"object","name":"ColumnDataSource","id":"p1076","attributes":{"selected":{"type":"object","name":"Selection","id":"p1077","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1078"},"data":{"type":"map","entries":[["DateTime_Interp",[]],["Cumulative_Interp",[]],["Incremental",[]],["bar_width",[]]]}}}],["source_daily",{"id":"p1067"}],["status_text_interp",{"type":"object","name":"TextInput","id":"p1757","attributes":{"width":400,"title":"Status:","value":"Waiting for file input."}}],["status_label_interp",{"type":"object","name":"Label","id":"p1756","attributes":{"text":"Waiting for file input.","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"30px","text_align":"center","x":333,"x_units":"screen","y":140,"y_units":"screen"}}],["status_text_inc",{"type":"object","name":"TextInput","id":"p1832","attributes":{"width":400,"title":"Status:","value":"Waiting for time interval input."}}],["status_label_inc",{"type":"object","name":"Label","id":"p1831","attributes":{"text":"Waiting for time interval input.","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"30px","text_align":"center","x":333,"x_units":"screen","y":240,"y_units":"screen"}}],["cumulativefile_input",{"id":"p1835"}],["dt_interp_input",{"type":"object","name":"TextInput","id":"p1833","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p1834","attributes":{"args":{"type":"map","entries":[["source_interp",{"id":"p1076"}],["source_preinterp_inc",{"id":"p1073"}],["status_text_inc",{"id":"p1832"}],["status_label_inc",{"id":"p1831"}],["dt_interp_input",{"id":"p1833"}],["plot_incremental",{"type":"object","name":"Figure","id":"p1758","attributes":{"width":1000,"height":480,"x_range":{"type":"object","name":"DataRange1d","id":"p1643"},"y_range":{"type":"object","name":"DataRange1d","id":"p1760"},"x_scale":{"type":"object","name":"LinearScale","id":"p1771"},"y_scale":{"type":"object","name":"LinearScale","id":"p1773"},"title":{"type":"object","name":"Title","id":"p1761","attributes":{"text":" ","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1826","attributes":{"data_source":{"id":"p1076"},"view":{"type":"object","name":"CDSView","id":"p1827","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1828"}}},"glyph":{"type":"object","name":"VBar","id":"p1823","attributes":{"x":{"type":"field","field":"DateTime_Interp"},"width":{"type":"field","field":"bar_width"},"top":{"type":"field","field":"Incremental"},"line_color":{"type":"value","value":"#98df8a"},"fill_color":{"type":"value","value":"#98df8a"}}},"nonselection_glyph":{"type":"object","name":"VBar","id":"p1824","attributes":{"x":{"type":"field","field":"DateTime_Interp"},"width":{"type":"field","field":"bar_width"},"top":{"type":"field","field":"Incremental"},"line_color":{"type":"value","value":"#98df8a"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"#98df8a"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"VBar","id":"p1825","attributes":{"x":{"type":"field","field":"DateTime_Interp"},"width":{"type":"field","field":"bar_width"},"top":{"type":"field","field":"Incremental"},"line_color":{"type":"value","value":"#98df8a"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"#98df8a"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1766","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1789"},{"type":"object","name":"BoxZoomTool","id":"p1790","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1791","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1792"},{"type":"object","name":"ResetTool","id":"p1793"},{"type":"object","name":"HoverTool","id":"p1829","attributes":{"renderers":[{"id":"p1826"}],"tooltips":[["Date Time","@DateTime_Interp{%H:%M %d/%m/%Y}"],["Incremental","@Incremental"]],"formatters":{"type":"map","entries":[["@DateTime_Interp","datetime"]]}}}],"active_drag":{"id":"p1790"},"active_scroll":{"id":"p1792"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1782","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1785","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1783"},"axis_label":"Incremental","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1784"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1819","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"click_policy":"hide","label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8}}],"below":[{"type":"object","name":"LinearAxis","id":"p1775","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1778","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1800","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1777"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1781","attributes":{"axis":{"id":"p1775"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1788","attributes":{"dimension":1,"axis":{"id":"p1782"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"id":"p1831"}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}],["bar_interp",{"id":"p1826"}]]},"code":"\n    \n        function StatusTextComplete(){\n            status_text_inc.value = 'Interpolation complete.'    \n            status_label_inc.text = ' '\n            }\n\n        function StatusTextInterpolating(){\n            status_text_inc.value = 'Interpolating rainfall data ...'\n            status_label_inc.text = 'Interpolating rainfall data ...'\n            }\n    \n    \n        // file loading ////////////////////////////////////////////////////\n        function process_data() {\n\n            // get data loaded from file\n            var DateTime_Input = source_preinterp_inc.data['DateTime_Input'];\n            var Cumulative_Input = source_preinterp_inc.data['Cumulative_Input']; \n            \n            // get dt_interp from input box\n            var dt_interp = parseFloat(dt_interp_input.value)\n            \n            // compute incremental amounts via interpolation of curve\n            let [DateTime_Interp, Cumulative_Interp, Incremental]  = ComputeIncrementalRainfall(DateTime_Input, Cumulative_Input, dt_interp);\n            var bar_width = [];\n            for (var i = 1; i &lt; DateTime_Interp.length; i++) {\n                    bar_width[i] = 0.9*dt_interp/60 * 3600000; \n                    }\n\n            // update source\n            source_interp.data = {DateTime_Interp: DateTime_Interp, Cumulative_Interp: Cumulative_Interp, Incremental: Incremental, bar_width: bar_width}; \n            source_interp.change.emit();\n            \n            \n        }  // end of process_file function\n    \n        function CallbackTiming(){\n            console.log(plot_incremental)\n            setTimeout(StatusTextInterpolating,0);\n            plot_incremental.title.text = 'Time Interval: ' + dt_interp_input.value + ' (minutes)';\n            setTimeout(process_data, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n        \n        CallbackTiming()\n        \n    "}}]]]},"title":"Interpolation time interval (minutes):","value":" "}}],["plot_cumulative_interp",{"type":"object","name":"Figure","id":"p1642","attributes":{"width":1000,"height":280,"x_range":{"id":"p1643"},"y_range":{"type":"object","name":"DataRange1d","id":"p1644"},"x_scale":{"type":"object","name":"LinearScale","id":"p1656"},"y_scale":{"type":"object","name":"LinearScale","id":"p1658"},"title":{"type":"object","name":"Title","id":"p1645","attributes":{"text":" ","text_color":"#E0E0E0","text_font":"Helvetica","text_font_size":"1.15em"}},"outline_line_color":"#E0E0E0","outline_line_alpha":0.25,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1711","attributes":{"data_source":{"id":"p1073"},"view":{"type":"object","name":"CDSView","id":"p1712","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1713"}}},"glyph":{"type":"object","name":"Line","id":"p1708","attributes":{"x":{"type":"field","field":"DateTime_Input"},"y":{"type":"field","field":"Cumulative_Input"},"line_color":"#ff7f0e","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1709","attributes":{"x":{"type":"field","field":"DateTime_Input"},"y":{"type":"field","field":"Cumulative_Input"},"line_color":"#ff7f0e","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1710","attributes":{"x":{"type":"field","field":"DateTime_Input"},"y":{"type":"field","field":"Cumulative_Input"},"line_color":"#ff7f0e","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1733","attributes":{"data_source":{"id":"p1076"},"view":{"type":"object","name":"CDSView","id":"p1734","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1735"}}},"glyph":{"type":"object","name":"Line","id":"p1730","attributes":{"x":{"type":"field","field":"DateTime_Interp"},"y":{"type":"field","field":"Cumulative_Interp"},"line_color":"#98df8a","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1731","attributes":{"x":{"type":"field","field":"DateTime_Interp"},"y":{"type":"field","field":"Cumulative_Interp"},"line_color":"#98df8a","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1732","attributes":{"x":{"type":"field","field":"DateTime_Interp"},"y":{"type":"field","field":"Cumulative_Interp"},"line_color":"#98df8a","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1650","attributes":{"logo":null,"tools":[{"type":"object","name":"PanTool","id":"p1674"},{"type":"object","name":"BoxZoomTool","id":"p1675","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1676","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"WheelZoomTool","id":"p1677"},{"type":"object","name":"ResetTool","id":"p1678"},{"type":"object","name":"HoverTool","id":"p1754","attributes":{"renderers":[{"id":"p1733"}],"tooltips":[["Date Time","@DateTime_Interp{%H:%M %d/%m/%Y}"],["Cumulative_Interp","@Cumulative_Interp"]],"formatters":{"type":"map","entries":[["@DateTime_Interp","datetime"]]}}}],"active_drag":{"id":"p1675"},"active_scroll":{"id":"p1677"}}},"left":[{"type":"object","name":"LinearAxis","id":"p1667","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1670","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1668"},"axis_label":"Cumulative Rainfall Total","axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1669"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"right":[{"type":"object","name":"Legend","id":"p1704","attributes":{"border_line_alpha":0,"background_fill_color":"#20262B","background_fill_alpha":0,"click_policy":"hide","label_text_color":"#E0E0E0","label_text_font":"Helvetica","label_text_font_size":"1.025em","label_standoff":8,"glyph_width":15,"spacing":8,"items":[{"type":"object","name":"LegendItem","id":"p1726","attributes":{"label":{"type":"value","value":"Cumulative Input"},"renderers":[{"id":"p1711"}]}},{"type":"object","name":"LegendItem","id":"p1753","attributes":{"label":{"type":"value","value":"Cumulative_Interp"},"renderers":[{"id":"p1733"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p1660","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1663","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"DatetimeTickFormatter","id":"p1685","attributes":{"minutes":"%H:%M %d/%m/%Y","hours":"%H:%M %d/%m/%Y","days":"%H:%M %d/%m/%Y","months":"%d/%m/%Y","years":"%d/%m/%Y"}},"axis_label_standoff":10,"axis_label_text_color":"#E0E0E0","axis_label_text_font":"Helvetica","axis_label_text_font_size":"1.25em","axis_label_text_font_style":"normal","major_label_policy":{"type":"object","name":"AllLabels","id":"p1662"},"major_label_text_color":"#E0E0E0","major_label_text_font":"Helvetica","major_label_text_font_size":"1.025em","axis_line_color":"#E0E0E0","axis_line_alpha":0,"major_tick_line_color":"#E0E0E0","major_tick_line_alpha":0,"minor_tick_line_color":"#E0E0E0","minor_tick_line_alpha":0}}],"center":[{"type":"object","name":"Grid","id":"p1666","attributes":{"axis":{"id":"p1660"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"type":"object","name":"Grid","id":"p1673","attributes":{"dimension":1,"axis":{"id":"p1667"},"grid_line_color":"#E0E0E0","grid_line_alpha":0.25,"minor_grid_line_color":"grey","minor_grid_line_alpha":0.1,"minor_grid_line_dash":[6]}},{"id":"p1756"}],"background_fill_color":"#20262B","border_fill_color":"#15191C"}}],["plot_incremental",{"id":"p1758"}]]},"code":"\n    \n        function StatusTextLoading(){\n            status_text_interp.value = 'Loading input cumulative rainfall data ...'\n            status_label_interp.text = 'Loading input cumulative rainfall data ...'\n            }\n        \n        function StatusTextComplete(){\n            status_text_interp.value = 'File import complete.'    \n            status_label_interp.text = ' '\n            status_text_inc.value = 'Waiting for user\\'s time interval input.'    \n            status_label_inc.text = 'Waiting for user\\'s time interval input.'\n\n            }\n\n        // file loading ////////////////////////////////////////////////////\n        function process_file() {\n    \n            //var file_contents = cb_obj.value;  // when using FileInput on change callback\n            var file_contents = cumulativefile_input.value;\n            \n            // read in entire file and decode text\n            const decoded_file_contents = atob(file_contents);\n            const file_lines = decoded_file_contents.split(\"\\n\");\n            \n            // initialise arrays        \n            var DateTime_Input = [];\n            var Cumulative_Input = [];\n            \n            // read the file data line by line   //////////////////////////////////\n            for (var i = 1; i &lt; file_lines.length; i++) {\n                \n                // read a line\n                var line = file_lines[i]\n                \n                // checks\n                if (line.trim().length === 0 || line.trim() === \"\") {continue}\n                \n                // get the time series data\n                var tmp = line.split(',')\n\n                var rain = parseFloat(tmp[1])\n                Cumulative_Input.push(rain);\n\n                // parse date time\n                // tmp[0] = 4/07/2005 9:33\n                var datetime_string = tmp[0];\n                var date_parts = datetime_string.split(\" \")[0].split(\"/\");\n                var time_parts = datetime_string.split(\" \")[1].split(\":\");\n                var datetime = new Date(date_parts[2], date_parts[1] - 1, date_parts[0], time_parts[0], time_parts[1]);\n                datetime = Math.floor(datetime.getTime()) // unix timestamp\n                DateTime_Input.push(datetime)\n                \n                } // end of line by line loop\n    \n            // create data source\n            source_preinterp_inc.data = {DateTime_Input: DateTime_Input, Cumulative_Input: Cumulative_Input}; \n            source_preinterp_inc.change.emit();\n\n            // compute incremental amounts via interpolation of curve\n            var dt_interp = 60; // default value of 60 minutes used on initial file load\n            let [DateTime_Interp, Cumulative_Interp, Incremental]  = ComputeIncrementalRainfall(DateTime_Input, Cumulative_Input, dt_interp);\n            var bar_width = [];\n            for (var i = 1; i &lt; DateTime_Interp.length; i++) {\n                    bar_width[i] = 0.9*dt_interp /60 * 3600000; \n                    }\n\n            // update source\n            source_interp.data = {DateTime_Interp: DateTime_Interp, Cumulative_Interp: Cumulative_Interp, Incremental: Incremental, bar_width: bar_width}; \n            source_interp.change.emit();\n\n            // reset dt input to default           \n            dt_interp_input.value = '60';\n            dt_interp_input.change.emit();\n\n        }  // end of process_file function\n    \n        function CallbackTiming(){\n            setTimeout(StatusTextLoading,0);\n            plot_cumulative_interp.title.text = cumulativefile_input.filename;\n            plot_incremental.title.text = 'Default Time Interval: 1 (hours)';\n            setTimeout(process_file, 1000);\n            setTimeout(StatusTextComplete, 1000);\n            }\n        \n        CallbackTiming()\n        \n    "}}]],["change:filename",[{"type":"object","name":"CustomJS","id":"p1838","attributes":{"args":{"type":"map","entries":[["cumulativefile_input",{"id":"p1835"}]]},"code":"\n          console.log('here')\n              const file = cumulativefile_input.filename\n              cumulativefile_input.title = cumulativefile_input.filename;\n              "}}]]]},"width":400,"value":"","mime_type":"","filename":"","accept":".csv"}},{"id":"p1757"},{"type":"object","name":"Div","id":"p1844","attributes":{"text":"&lt;h2&gt;2. Enter the rainfall time increment (minutes):&lt;/h2&gt;\n              &lt;p&gt;&lt;i&gt;Hit ENTER to execute interpolation.&lt;/i&gt;&lt;/p&gt;&lt;br&gt;\n            "}},{"id":"p1833"},{"id":"p1832"},{"type":"object","name":"Button","id":"p1839","attributes":{"button_type":"success","js_event_callbacks":{"type":"map","entries":[["button_click",[{"type":"object","name":"CustomJS","id":"p1840","attributes":{"args":{"type":"map","entries":[["source_interp",{"id":"p1076"}],["status_text_inc",{"id":"p1832"}],["status_label_inc",{"id":"p1831"}],["cumulativefile_input",{"id":"p1835"}]]},"code":"\n\n                                  function StatusTextSaving(){\n                                      status_text_inc.value = 'Exporting data ...'\n                                      status_label_inc.text = 'Exporting data ...'\n                                      }\n                                  \n                                  function StatusTextComplete(){\n                                      status_text_inc.value = 'Data export complete.'    \n                                      status_label_inc.text = ' '\n                                      }\n\n                                   function processing(){\n                                        \n                                        var data = source_interp.data;\n                                        var datetime = data['DateTime_Interp'];\n                                        var cumulative = data['Cumulative_Interp'];\n                                        var incremental = data['Incremental'];\n                                        \n                                        var csv_data = 'DateTime,CumulativeRainfall,IncrementalRainfall\\n';\n                                        for (var i = 0; i &lt; datetime.length; i++) {\n                                            var date = new Date(datetime[i]);\n                                            var formatted_timestamp = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n                                            csv_data += formatted_timestamp + ',' + cumulative[i].toFixed(2) +  ',' + incremental[i].toFixed(2) + '\\n';\n                                        }\n                                        \n                                        var blob = new Blob([csv_data], { type: 'text/csv;charset=utf-8;' });\n                                        var link = document.createElement(\"a\");\n                                        if (link.download !== undefined) {\n                                            link.setAttribute(\"href\", window.URL.createObjectURL(blob));\n                                            var csvFile = cumulativefile_input.filename.slice(0,cumulativefile_input.filename.length-4)+'_Interpolated.csv'\n                                            link.setAttribute(\"download\", csvFile);\n                                            link.style.visibility = 'hidden';\n                                            document.body.appendChild(link);\n                                            link.click();\n                                            document.body.removeChild(link);\n                                        }                                       \n                                        }\n                                   \n                                   function CallbackTiming(){\n                                       setTimeout(StatusTextSaving,0);\n                                       setTimeout(processing, 1000);\n                                       setTimeout(StatusTextComplete, 1000);\n                                       }\n                               \n                                   CallbackTiming()\n\n\n    "}}]]]},"label":"Export Interpolated Data"}}]}},{"type":"object","name":"Column","id":"p1846","attributes":{"children":[{"id":"p1642"},{"id":"p1758"}]}}]}}}}]}}]}}
    </script>
    <script type="text/javascript">
      (function() {
        const fn = function() {
          Bokeh.safely(function() {
            (function(root) {
              function embed_document(root) {
              const docs_json = document.getElementById('p3095').textContent;
              const render_items = [{"docid":"3b026170-7425-43fa-9bc2-8c69456f51ec","roots":{"p1849":"65ba0c3d-9da8-4d18-acb1-01e174d19313"},"root_ids":["p1849"]}];
              root.Bokeh.embed.embed_items(docs_json, render_items);
              }
              if (root.Bokeh !== undefined) {
                embed_document(root);
              } else {
                let attempts = 0;
                const timer = setInterval(function(root) {
                  if (root.Bokeh !== undefined) {
                    clearInterval(timer);
                    embed_document(root);
                  } else {
                    attempts++;
                    if (attempts > 100) {
                      clearInterval(timer);
                      console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                    }
                  }
                }, 10, root)
              }
            })(window);
          });
        };
        if (document.readyState != "loading") fn();
        else document.addEventListener("DOMContentLoaded", fn);
      })();
    </script>
  </body>
</html>